function type(e,r,a){for(r=1,t=0;r<a.length;++r)t+=e[a[r]]=+e[a[r]];e.total=t;var n=d3.timeParse("%d-%b-%Y");return e.date=n(e.date),e}function dblclick(t){d3.select(this).classed("fixed",t.fixed=function(){return 1!=t.fixed})}function dragstart(t){d3.select(this).classed("fixed",t.fixed=!0)}function createVisualization(t){initializeBreadcrumbTrail(),drawLegend(),d3.select("#togglelegend").on("click",toggleLegend),vis.append("svg:circle").attr("r",radius).style("opacity",0);var e=partition.nodes(t).filter(function(t){return t.dx>.005}),r=vis.data([t]).selectAll("path").data(e).enter().append("svg:path").attr("display",function(t){return t.depth?null:"none"}).attr("d",arc).attr("fill-rule","evenodd").style("fill",function(t){return colors[t.name]}).style("opacity",1).on("mouseover",mouseover);d3.select("#container").on("mouseleave",mouseleave),totalSize=r.node().__data__.value}function mouseover(t){var e=(100*t.value/totalSize).toPrecision(3),r=e+"%";e<.1&&(r="< 0.1%"),d3.select("#percentage").text(r),d3.select("#explanation").style("visibility","");var a=getAncestors(t);updateBreadcrumbs(a,r),d3.selectAll("path").style("opacity",.3),vis.selectAll("path").filter(function(t){return a.indexOf(t)>=0}).style("opacity",1)}function mouseleave(t){d3.select("#trail").style("visibility","hidden"),d3.selectAll("path").on("mouseover",null),d3.selectAll("path").transition().duration(1e3).style("opacity",1).each("end",function(){d3.select(this).on("mouseover",mouseover)}),d3.select("#explanation").style("visibility","hidden")}function getAncestors(t){for(var e=[],r=t;r.parent;)e.unshift(r),r=r.parent;return e}function initializeBreadcrumbTrail(){var t=d3.select("#sequence").append("svg:svg").attr("width",width).attr("height",50).attr("id","trail");t.append("svg:text").attr("id","endlabel").style("fill","#000")}function breadcrumbPoints(t,e){var r=[];return r.push("0,0"),r.push(b.w+",0"),r.push(b.w+b.t+","+b.h/2),r.push(b.w+","+b.h),r.push("0,"+b.h),e>0&&r.push(b.t+","+b.h/2),r.join(" ")}function updateBreadcrumbs(t,e){var r=d3.select("#trail").selectAll("g").data(t,function(t){return t.name+t.depth}),a=r.enter().append("svg:g");a.append("svg:polygon").attr("points",breadcrumbPoints).style("fill",function(t){return colors[t.name]}),a.append("svg:text").attr("x",(b.w+b.t)/2).attr("y",b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.name}),r.attr("transform",function(t,e){return"translate("+e*(b.w+b.s)+", 0)"}),r.exit().remove(),d3.select("#trail").select("#endlabel").attr("x",(t.length+.5)*(b.w+b.s)).attr("y",b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(e),d3.select("#trail").style("visibility","")}function drawLegend(){var t={w:75,h:30,s:3,r:3},e=d3.select("#legend").append("svg:svg").attr("width",t.w).attr("height",d3.keys(colors).length*(t.h+t.s)),r=e.selectAll("g").data(d3.entries(colors)).enter().append("svg:g").attr("transform",function(e,r){return"translate(0,"+r*(t.h+t.s)+")"});r.append("svg:rect").attr("rx",t.r).attr("ry",t.r).attr("width",t.w).attr("height",t.h).style("fill",function(t){return t.value}),r.append("svg:text").attr("x",t.w/2).attr("y",t.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.key})}function toggleLegend(){var t=d3.select("#legend");"hidden"==t.style("visibility")?t.style("visibility",""):t.style("visibility","hidden")}function buildHierarchy(t){for(var e={name:"root",children:[]},r=0;r<t.length;r++){var a=t[r][0],n=+t[r][1];if(!isNaN(n))for(var i=a.split("-"),l=e,s=0;s<i.length;s++){var o,c=l.children,d=i[s];if(s+1<i.length){for(var u=!1,h=0;h<c.length;h++)if(c[h].name==d){o=c[h],u=!0;break}u||(o={name:d,children:[]},c.push(o)),l=o}else o={name:d,size:n},c.push(o)}}return e}function update(t){var e=tree.nodes(root).reverse(),r=tree.links(e);e.forEach(function(t){t.y=180*t.depth});var a=svg.selectAll("g.node").data(e,function(t){return t.id||(t.id=++i)}),n=a.enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+t.y0+","+t.x0+")"}).on("click",click);n.append("circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),n.append("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}).style("fill-opacity",1e-6);var l=a.transition().duration(duration).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});l.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),l.select("text").style("fill-opacity",1);var s=a.exit().transition().duration(duration).attr("transform",function(e){return"translate("+t.y+","+t.x+")"}).remove();s.select("circle").attr("r",1e-6),s.select("text").style("fill-opacity",1e-6);var o=svg.selectAll("path.link").data(r,function(t){return t.target.id});o.enter().insert("path","g").attr("class","link").attr("d",function(e){var r={x:t.x0,y:t.y0};return diagonal({source:r,target:r})}),o.transition().duration(duration).attr("d",diagonal),o.exit().transition().duration(duration).attr("d",function(e){var r={x:t.x,y:t.y};return diagonal({source:r,target:r})}).remove(),e.forEach(function(t){t.x0=t.x,t.y0=t.y})}function click(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),update(t)}function type(t){return t.value=+t.value,t}function dollarFormatter(t){t=Math.round(t);var e=t;return Math.abs(t)>1e3&&(e=Math.round(t/1e3)+"K"),"$"+e}var width=950,height=400,vis=d3.select("#decomp").append("svg:svg").attr("width",width).attr("height",height),margin={top:20,right:20,bottom:30,left:50},g=vis.append("svg:g").attr("transform","translate("+margin.left+","+margin.top+")"),width=+vis.attr("width")-margin.left-margin.right,height=+vis.attr("height")-margin.top-margin.bottom,x=d3.scaleTime().rangeRound([0,width]),y=d3.scaleLinear().rangeRound([height,0]),z=d3.scaleOrdinal(d3.schemeCategory10),stack=d3.stack();d3.csv("data/decomp.csv",type,function(t,e){if(t)throw t;x.domain(d3.extent(e,function(t){return t.date})),y.domain([0,d3.max(e,function(t){return t.total})]).nice(),z.domain(e.columns.slice(1)),g.selectAll(".serie").data(stack.keys(e.columns.slice(1))(e)).enter().append("g").attr("class","serie").attr("fill",function(t){return z(t.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return x(t.data.date)}).attr("y",function(t){return y(t[1])}).attr("height",function(t){return y(t[0])-y(t[1])}).attr("width",16),g.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+height+")").call(d3.axisBottom(x)),g.append("g").attr("class","axis axis--y").call(d3.axisLeft(y).ticks(3,"s")).append("text").attr("x",2).attr("y",y(y.ticks(10).pop())).attr("dy","0.35em").attr("text-anchor","start").attr("fill","#000").text("Sales")});var svg=d3.select("svg"),margin={top:20,right:20,bottom:30,left:50},width=+svg.attr("width")-margin.left-margin.right,height=+svg.attr("height")-margin.top-margin.bottom,g=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),parseTime=d3.timeParse("%H:%M:%S"),x=d3.scaleTime().rangeRound([0,width]),y=d3.scaleLinear().rangeRound([height,0]),actual=d3.line().x(function(t){return x(t.date)}).y(function(t){return y(t.close)}),counterfactual=d3.line().x(function(t){return x(t.date)}).y(function(t){return y(t.open)}),incremental=d3.area().x(function(t,e){return x(t.date)}).y0(function(t){return y(t.open)}).y1(function(t){return y(t.close)});d3.csv("data/lift.csv",function(t){return t.date=parseTime(t.date),t.close=+t.close,t},function(t,e){if(t)throw t;x.domain(d3.extent(e,function(t){return t.date})),y.domain(d3.extent(e,function(t){return t.close})),g.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+height+")").call(d3.axisBottom(x)),g.append("g").attr("class","axis axis--y").call(d3.axisLeft(y)).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").style("text-anchor","end").text("Web Visits"),g.append("g").attr("class","label").append("line").attr("transform","translate(0, -200)").attr("y1",650).attr("y2",200).attr("x1",455).attr("x2",455).attr("stroke","gray").attr("stroke-dasharray","5 5"),d3.select(".label").append("text").attr("transform","translate(450, 0)").attr("fill","#393939").style("text-anchor","end").text("Spot Airing Time"),g.append("path").datum(e).attr("class","actual").attr("d",actual),g.append("path").datum(e).attr("class","counterfactual").attr("d",counterfactual),g.append("path").datum(e).attr("class","incremental").attr("d",incremental)});var w=900,h=650,fill=d3.scale.category20(),grav=.2,container=d3.select("#network").append("svg:svg").attr("width",w).attr("height",h),force=d3.layout.force().size([w,h]).charge(function(t){return-10*t.weight}).friction(.5).linkDistance(function(t){return 0==t.source.id||1==t.target.id?500:400}).linkStrength(.1).gravity(grav).theta(.5),drag=force.drag().on("dragstart",dragstart);d3.json("data/force.json",function(t,e){if(t)throw t;force.nodes(e.nodes).links(e.links).start();var r=container.selectAll("line.link").data(e.links).enter().append("svg:line").attr("class","link").style("stroke-width",function(t){return 10*t.weight}).style("stroke",function(t){return 0!=t.source.id?fill(t.source.grouping):"black"}).attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),a=container.selectAll("circle.node").data(e.nodes).enter().append("svg:circle").attr("class","node").attr("cx",function(t){return 0==t.id?(t.x=-2e3,t.x):1==t.id?(t.x=4e3,t.x):20*t.grouping}).attr("cy",function(t){return t.y}).attr("r",function(t){return 100*Math.sqrt(t.weighting)}).style("fill",function(t){return 0!=t.id&&1!=t.id?fill(t.grouping):(fill(t.grouping),"black")}).on("dblclick",dblclick).call(drag);a.append("svg:title").text(function(t){return t.name});var n=container.selectAll("text.node").data(e.nodes).enter().append("text").attr("dx",function(t){return t.x}).attr("dy",function(t){return t.y}).text(function(t){return t.name}).attr("font-size","10px");container.style("opacity",1e-6).transition().duration(1e3).style("opacity",1),force.on("tick",function(t){r.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),a.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),n.attr("dx",function(t){return t.x+20}).attr("dy",function(t){return t.y+20})})});var width=750,height=600,radius=Math.min(width,height)/2,b={w:75,h:30,s:3,t:10},colors={home:"#5687d1",product:"#7b615c",search:"#de783b",account:"#6ab975",other:"#a173d1",end:"#bbbbbb"},totalSize=0,vis=d3.select("#chart").append("svg:svg").attr("width",width).attr("height",height).append("svg:g").attr("id","container").attr("transform","translate("+width/2+","+height/2+")"),partition=d3.layout.partition().size([2*Math.PI,radius*radius]).value(function(t){return t.size}),arc=d3.svg.arc().startAngle(function(t){return t.x}).endAngle(function(t){return t.x+t.dx}).innerRadius(function(t){return Math.sqrt(t.y)}).outerRadius(function(t){return Math.sqrt(t.y+t.dy)});d3.text("data/visit-sequences.csv",function(t){var e=d3.csv.parseRows(t),r=buildHierarchy(e);createVisualization(r)});var width=400,height=400,structureVis=d3.select("#structure").append("svg:svg").attr("width",width).attr("height",height),margin={top:20,right:20,bottom:30,left:50},structg=structureVis.append("svg:g").attr("transform","translate("+margin.left+","+margin.top+")"),width=+structureVis.attr("width")-margin.left-margin.right,height=+structureVis.attr("height")-margin.top-margin.bottom;structg.append("rect").attr("x",70).attr("y",0).attr("height",50).attr("width",150).attr("fill","steelblue").attr("class","serie").on("click",function(){console.log("clicked")}),structg.append("text").text("Customer Base").attr("x",95).attr("y",30).attr("fill","white"),structg.append("path").attr("d","M150 50 V 70 H 80 V100").attr("fill","transparent").attr("stroke","black"),structg.append("path").attr("d","M150 50 V 70 H 220 V100").attr("fill","transparent").attr("stroke","black"),structg.append("path").attr("d","M80 150 V 180 H 30 V200").attr("fill","transparent").attr("stroke","black"),structg.append("path").attr("d","M80 150 V 180 H 120 V200").attr("fill","transparent").attr("stroke","black"),structg.append("rect").attr("x",30).attr("y",100).attr("height",50).attr("width",100).attr("fill","steelblue").attr("class","serie"),structg.append("text").text("Online").attr("x",60).attr("y",130).attr("fill","white"),structg.append("rect").attr("x",170).attr("y",100).attr("height",50).attr("width",100).attr("fill","steelblue").attr("class","serie"),structg.append("text").text("Offline").attr("x",200).attr("y",130).attr("fill","white"),structg.append("rect").attr("x",0).attr("y",200).attr("height",40).attr("width",70).attr("fill","steelblue").attr("class","serie"),structg.append("text").text("New").attr("x",20).attr("y",225).attr("fill","white"),structg.append("rect").attr("x",80).attr("y",200).attr("height",40).attr("width",70).attr("fill","steelblue").attr("class","serie"),structg.append("text").text("Repeat").attr("x",93).attr("y",225).attr("fill","white");var margin={top:20,right:120,bottom:20,left:120},width=960-margin.right-margin.left,height=600-margin.top-margin.bottom,i=0,duration=750,root,tree=d3.layout.tree().size([height,width]),diagonal=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),svg=d3.select("#tree").append("svg").attr("width",width+margin.right+margin.left).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.json("data/flare.json",function(t,e){function r(t){t.children&&(t._children=t.children,t._children.forEach(r),t.children=null)}if(t)throw t;root=e,root.x0=height/2,root.y0=0,root.children.forEach(r),update(root)}),d3.select(self.frameElement).style("height","800px");var margin={top:20,right:30,bottom:30,left:40},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom,padding=.3,yoyx=d3.scaleBand().rangeRound([0,width]).paddingInner(padding),yoyy=d3.scaleLinear().range([height,0]),yoyxaxis=d3.axisBottom().scale(yoyx),yoyyaxis=d3.axisLeft().scale(yoyy).tickFormat(function(t){return dollarFormatter(t)}),chart=d3.select("#yoy").append("svg:svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.csv("data/yoy.csv",type,function(t,e){for(var r=0,a=0;a<e.length;a++)e[a].start=r,r+=e[a].value,e[a].end=r,e[a]["class"]=e[a].value>=0?"positive":"negative";e.push({name:"2016 Revenue",end:r,start:0,"class":"total"}),console.log(e),yoyx.domain(e.map(function(t){return t.name})),yoyy.domain([0,d3.max(e,function(t){return t.end})]),chart.append("g").attr("class","x axis").attr("transform","translate(0, 450)").call(yoyxaxis),chart.append("g").attr("class","y axis").call(yoyyaxis);var n=chart.selectAll(".bar").data(e).enter().append("g").attr("class",function(t){return"bar "+t["class"]}).attr("transform",function(t){return"translate("+yoyx(t.name)+",0)"});n.append("rect").attr("y",function(t){return yoyy(Math.max(t.start,t.end))}).attr("height",function(t){return Math.abs(yoyy(t.start)-yoyy(t.end))}).attr("width",yoyx.bandwidth()),n.append("text").attr("x",yoyx.bandwidth()/2).attr("y",function(t){return yoyy(t.end)+5}).attr("dy",function(t){return("negative"==t["class"]?"-":"")+".75em"}).text(function(t){return dollarFormatter(t.end-t.start)}),n.filter(function(t){return"total"!=t["class"]}).append("line").attr("class","connector").attr("x1",yoyx.bandwidth()+5).attr("y1",function(t){return yoyy(t.end)}).attr("x2",yoyx.bandwidth()/(1-padding)-5).attr("y2",function(t){return yoyy(t.end)})});
//# sourceMappingURL=main.min.js.map
